\chapter{Návrh testů pro Conel routery}
V této fázi je připraven celý systém pro testování routerů. Testovací laboratoř se všemi výrobky je kompletně postavena. Testovací server je nainstalován a nakonfigurován. Máme navrhnutou databázi a adresářovou strukturu tetovacího systému. Systém pro stahování zdrojový kódů, kompilování projektů a následné spouštění testů již také funguje správně. Pro provádění jednotlivých kroků testů jsou k dispozici programy z testovacího API a výsledky všech testů je možné zobrazit pomocí webových stránek.

V neposlední řadě je navrhnut přístup testování založený na modelech. Pomocí tohoto přístupu rozdělíme všechny funkcionality všech routerů do funkcí. Následně každou funkci rozdělme na jednotlivé procedury, kdy každá procedura testuje elementární chování této funkce. Například pokud je dána funkce připojení routeru do mobilní sítě a v této funkci je testovací procedura testující změny APN tohoto připojení. Pomocí těchto funkcí je možné namodelovat všechny testovaná zařízení. Pomocí těchto modelů jsou pro každé zařízení vybírány a spouštěny konkrétní testy.

Pro základní testování funkčnosti celého portfolia výrobků společnosti Conel byli navržený následující funkce a testovací procedury. V první fázi implementace testovacího systému budou spouštěny tyto níže popisované procedury.

Testovací skripty jsou spouštěny se dvěma parametry. Prvním parametre je identifikační číslo testovaného zařízení. Pomocí tohoto čísla je možné komunikovat s daným zařízením a zjišťovat detailní informace o zařízení z databáze pomocí programů popsaných v sekci věnující se testovacímu API. Druhým parametrem je předáváno identifikační číslo testovaného releasu.

\section{Checkout}
Testování každého projektu je započato stažením zdrojových kódů daného projektu. Způsob stažení zdrojového kódu je zajištěno pomocí skriptů checkout. V tomto skriptu definujeme způsob stažení zdrojový kódu. Například stažení pomocí verzovacích systémů git, či cvs nebo zkopírování projektu z určitého místa. Všechny projekty testovacího systému se stahují pomocí verzovacího systému git přímo ze serveru testovací laboratoře, kde jsou vytvořeny kopie repozitářů všech testovaných projektů. Kopie je pravidelně každou minutu udržována aktuální. Tento postup byl zaveden z důvodu zrychlení samotného testování a rapidní zmenšení datových toků. Primárně je stahována hlavní větev master.

\section{Compile}
Pro každý projekt je dále napsán skript zajišťující kompilaci daného projektu a vybraného produktu. Skript je pouštěn se dvěma parametry. Prvním parametrem je cílový adresář kam má být výsledný firmware nakopírován a druhým parametrem je název překládaného výrobku. Prozatím se pro všechny testované projekty používá buildovací systém ltib, tudíž skripty zajišťující překlad projektů vypadají velice obdobně. Každý skript je prováděn v adresáři, kde je projekt stažen. V prvním kroku je otevřen adresář ltib. Dále pokud se překládá první výrobek platformy, tak je vybrána zpracovávaná platforma. Samotné vybrání platformy je provedeno ve dvou krocích. V prvním kroku je spuštěn skript platform s parametrem název platformy. Skript platform byl do buildovacího systému doplněn v rámci testovací laboratoře, jelikož ltib nepodporoval překládání bez interakce uživatele. Výběr platformy je dokončen spuštěním programu ltib v konfiguračním režimu. V dalším kroku je vybrán produkt, který má být překládán. Vybrání produktu je provedeno zapsáním jeho názvu do souboru appname. Nyní jsou smazány přeložené části závisející na výrobku a spuštěn samotný překlad. V případě úspěšného ukončení překladu jsou přeložené firmwary nakopírovány do adresáře předaného jako parametr skriptu. Překládání projektů pomocí skriptů bylo zvoleno z důvodu univerzálnosti a jednoduchém přidávání nových projektů založených na různých buildovacích systémech.

\section{Clean}
Před ukončením testování je prováděn úklid po kompilaci projektů. Aby bylo možné smazat všechny soubory a adresáře zdrojových kódu a soubory vytvořené při samotném překladu je nutné provést clean nad projektem. Jelikož clean každého projektu je prováděn odlišným způsobem, je pro každý projekt vytvořen vlastní skript. Pro projekty, které jsou zatím testovány v testovací laboratoři je nejdříve otevře adresář ltib. Samotný úklid po překladu je proveden spuštěním programu ltib v módu distclean. Na závěr se skript vrátí do výchozího adresáře a je ukončen s návratovým kódem programu ltib.

\section{Funkce firmware}
Základní funkcionalitou každého výrobku je možnost nahrání nového firmwaru. Na funkci nahrání nového firmwaru je založeno veškeré další testování. Pokud se nepodaří nahrát nový firmware není důvod testovat jakoukoliv funkcionalitu, jelikož tyto testy neodpovídají danému firmwaru.

\subsection{Procedura upload}
První testovací procedura funkce firmware testuje nahrání firmwaru do testovaného zaříení. V prvním kroku je zjištěn název firmwaru testovaného zařízení z databáze testovacího systému. Dále je správný firmware nahrán do testovaného zařízení pomocí utility updatefw z testovacího API. Test je ukončen úspěšně, pokud se podaří nahrát firmware do zařízení.

\subsection{Procedura start}
Další testovací procedura funkce firmware testuje, jestli router po nahrání firmwaru nastartoval. V tomto testu se nejdříve jednu sekundu čeká na reboot routeru po ukončení programování, jelikož pokud by se router testoval ihned po naládování, testoval by se ještě běžící starý firmware. Dále je spuštěn program testující připojení routeru do testovací sítě. V tomto programu je nejdříve testován ping na router a v případě úspěšného pingu je testováno odezva routeru na příkaz echo. Test končí úspěšně, pokud se na routeru podaří ping a také se k němu podaří připojit jedním z podporovaných protokolů. Tento test vrací také čas startu routeru v sekundách.

\subsection{Procedura check}
Poslední procedura funkce firmware check testuje shodu verzi firmwaru v routeru s nahrávanou verzí firmwaru testovacím systémem. V první fázi je z databáze zjištěn název firmwaru testovaného výrobku. Pomocí názvu firmwaru je nalezen a jeho obsah uložen do proměnné soubor s verzí firmwaru dodávaný s přeloženým firmware. Po zjištění požadovaného firmwaru je zjištěn aktuální firmware v zařízení pomocí programu status. Nakonec jsou tyto dvě verze porovnány a skript je úspěšně ukončen, pokud jsou obě verze totožné.

\section{Funkce configuration}
Další funkcionalitou, kterou podporují všechny testované zařízení je funkcionalita obsluhující konfigurace. Konfigurace zařízení je seznam parametrů s hodnotami určující chování daného zařízení. Funkcionalita konfigurace je také velmi důležitá, jelikož v každém testu je nastavována odlišná konfigurace a sleduje se chování daného zařízení. Pro práci s konfigurací je v zařízeních několik základních nástrojů. Konfigurace je možné zálohovat a nahrávat nové. Dále je možné pracovat s takzvanými profily. K dispozici jsou až čtyři alternativní profily. Nakonec je možné měnit parametry přímo v routeru přepisováním určitých souborů.

\section{Funkce connect}
Nyní přicházejí dvě základní funkcionality, které obstarávají připojení do routeru. K dispozici jsou dvě možnosti připojení do testovaných zařízení. Ne všechny testovaná zařízení podporují oba typy připojení. První typ připojení do routeru je pomocí klasických nešifrovaných protokolů telnet, ftp, http. Jedná se o nezabezpečené připojení, tudíž není podporováno nejnovějšími zařízení platformy v3.

\subsection{Procedura telnet}
První procedura telnet testuje připojení do routeru pomocí protokolu telnet. Nejdříve je zjištěn původní komunikační protokol, aby bylo možné před ukončením testu protokol zpět obnovit. Komunikační protokol je zjištěn z remote serveru pomocí programu remoteinfo z testovacího API. Dále je remote serveru odeslán požadavek na změnu komunikačního protokolu pomocí programu remotechange. Po změně protokolu je kontrolováno, jestli se protokol opravdu změnil a to opět pomocí programu remoteinfo. Na závěr je provedena zkouška komunikace pomocí telnet protokolu. Zkouška komunikace je provedena pomocí programu remote a příkazu echo, následná kontrola komunikace je prováděna porovnáním vráceného řetězce s řetězcem vypisovaným příkazem echo. Posledním krokem tohoto testu je vrácení původního komunikačního protokolu remote serveru.

\section{Funkce connect ssh}
Druhým možným způsobem komunikace s testovanými zařízeními je pomocí zabezpečeného šifrovaného protokolu ssh. S podporou protokolu ssh souvisejí i další šifrované typy připojení klasických protokolů. Například zabezpečená varianta ftps protokolu pro přenos dat ftp, dále šifrovaná varianta https webové protokolu http. Zabezpečené šifrované protokoly nepodporují kvůli malému výkonu starší modely testovaných zařízení, naopak nejnovější modely zařízení podporují pouze tento druh spojení.

\subsection{Procedura ssh}
Procedura ssh testuje spojení s testovaným zařízením skrz šifrovaný protokol ssh. Připojení protokolem ssh je prováděno pomocí programu plink, jelikož standardní ssh klient nedovoluje zadání hesla připojení jako parametr. Tato funkcionalita je stejně jako telnet zaintegrována do remote serveru, tudíž je možné se k ssh spojení chovat stejně jako k telnet spojení. Díky tomuto faktu vypadá testovací procedura totožně jako testovací procedura pro telnet s jediným rozdílem. Při změně protokolu pomocí programu remotechange se jako parametr nepředává telnet nýbrž řetězec ssh. Podmínka úspěšnosti provedení testu je taktéž totožná s procedurou telnet.

\section{Funkce mobile}
Nyní již jsou popsány všechny funkcionality nutné k testování všech zařízeních a přejdeme k popisu všech ostatních funkcionalit. První testovaná funkcionalita je funkce mobile. Funkce mobile v sobě obsahuje společný základ všech bezdrátových možností připojení. Základními vlastnostmi připojení jsou například přiřazení IP adresy, zkouška komunikace či změna parametru určující velikost odchozího packetu MTU. Jednotlivé vlastnosti této funkcionality jsou popsány v testovacích procedurách testujících tuto vlastnost. Tato funkce naopak nezohledňuje typ spojení bezdrátového modulu se zařízením, či podporované bezdrátové technologie.

\subsection{Procedura connect}
Procedura connect popisuje vlastnost routeru připojení pomocí mobilního spojení. Úspěšné připojení do mobilní sítě je definováno přiřazením IP adresy interfacu mobilního spojení. Samotný test probíhá pouze spuštěním programu mobileready, který čeká 3 minuty na přiřazení IP adresy interfacu mobilního spojení. Program, tedy i skript vypisuje pouze čas v sekundách, který čekal na připojení routeru do mobilní sítě. Skript je ukončen úspěšně, pokud se routeru podaří připojit do mobilní sítě do třech minut.

\subsection{Procedura ping}
Procedura ping popisuje vlastnost routeru základní komunikace v mobilní síti. Vlastnost základní komunikace je popsána provedením alespoň jednoho úspěšného pingu na zařízení v mobilní síti. Samotný test probíhá následovně. V prvním kroku je zálohováno původní APN. Poté je změněno APN mobilního spojení na conel.agnep.cz, aby byla na všemi zařízeními přístupná referenční adresa. Kvůli projevení změny APN je proveden restart služby PPP starající se o mobilní spojení. Po restartu mobilního spojení je čekáno na sestavení mobilního spojení s novým APN pomocí programu mobileready. V případě úspěšného navázání mobilního spojení je proveden ping s pěti pokusy na adresu 10.0.0.1. Na závěr je parametru APN navrácená původní hodnota. Skript vypisuje číselnou hodnotu v procentech počtu úspěšně provedených pingů. Test je ukončen jako úspěšný, jestliže byl úspěšně přijat zpět alespoň jeden pokus o ping na adresu 10.0.0.1.

\subsection{Procedura apn}
Procedura apn popisuje možnost ovlivnění chování mobilního spojení pomocí parametru APN. Parametr APN určuje síť, ke které se testované zařízení připojuje. Testovaná zařízení typicky obsahují SIM karty podporující firemní apn conel.agnep.cz a APN umožňující přístup do internetu internet.t-mobile.cz. Test vlastnosti zkoumá, jestliže se změní síť mobilního připojení při změně parametru APN. Samotný test probíhá následovně. Nejdříve je zálohováno původní APN. Následuje změna APN na conel.agnep.cz. Kvůli projevení změny APN je proveden restart mobilního spojení. Dále pomocí programu mobileready je čekáno na sestavení mobilního spojení. Po sestavení mobilního spojení je zjištěna přidělená IP adresa mobilního interfacu. Stejný postup je proveden pro zadání internetového APN. V případě pokud se router v obou zadaných APN připojil do mobilní sítě, jsou porovnávány IP adresy obou připojení. Jestliže jsou IP adresy různé, tak je funkcionalita správná a test ukončen úspěšně.

\subsection{Procedura address}
Procedura address popisuje vlastnost mobilního spojení přiřazující IP adresu rozhraní mobilního spojení. Pokud známe IP adresu SIM karty v určitém APN, můžeme zadat tuto adresu jako parametr mobilního spojení. Při vytváření mobilního spojení se použije tato adresa a vytvoření spojení by se mělo provést rychleji. Test této funkcionality odpovídá zadáním IP adresy SIM karty a úspěšném vytvoření spojení. Test je prakticky implementován následovně. Nejdříve je zálohovány parametry routeru IP adresa a APN. Poté je z databáze zjištěna IP adresa SIM karty vložené do testovaného routeru. Po zjištění IP adresy je tato adresa zadána jako parametr mobilního spojení, druhým měněným parametrem je APN, pro které je tato adresa použita. Pro kontrolu funkčnosti zadání IP adresy je restartováno mobilní spojení a pomocí programu mobileready je čekáno na sestavení mobilního spojení. Skript je úspěšně ukončen, jestliže IP adresa SIM karty získaná z databáze je totožná s IP adresou SIM karty přidělené mobilnímu rozhraní. Skript nadále vypisuje čas v sekundách, za jak dlouho se router připojil do mobilní sítě. Na závěr skript navrátí původní nastavení routeru.

\subsection{Procedura operator}
Procedura operator popisuje vlastnost určení operátora mobilního spojení. Operátor je určen pětimístným číselným kódem. Zadáním parametru operátor je urychleno připojení do mobilní sítě, či možnost změnit operátora, pokud to SIM karta umožňuje. Testování této vlastnosti mobilního spojení probíhá následovně. V první fázi je zálohována nynější položka konfigurace operátor. Poté je z databáze zjištěn operátor SIM karty testovaného zařízení. Získaný operátor je zadán jako nový parametr testovaného zařízení operátor. Z důvodu provedení změny v konfiguraci je proveden restart mobilního spojení a dále je čekáno na znovu sestavení mobilního spojení. Pokud bylo spojení úspěšně navázáno je porovnáván přidělený operátor s operátorem zadaném jako parametr, jestliže jsou tyto operátoři totožné, je skript ukončen s nulovým návratovým kódem. Skript tiskne na standardní výstup dobu sestavování spojení se zadaným operátorem v konfiguraci.

\subsection{Procedura mtu}
Procedura mtu popisuje vlastnost mobilního spojení ovlivňující velikost odesílaného packetu. Při změně tohoto parametru bychom měli sledovat změnu velikosti odesílaných packetů. Testování změny parametru MTU je prováděno následujícím způsobem. Nejdříve je zálohována nynější hodnota MTU a nastavíme novou hodnotu MTU na 500. Pro aplikaci změn v nastavení necháme restartovat mobilní spojení a počkáme na znovu navázání tohoto spojení. Po připojení testovaného zařízení do mobilní sítě je zjištěn název rozhraní mobilního spojení pro účely diagnostiky provozu sítě. Dále je v routeru na pozadí spuštěn ping s velikostí větší než nastavená maximální velikost packetu. Ping na pozadí je spouštěn pomocí programu z testovacího API pingb. V průběhu pingu je v testovaném routeru zároveň puštěn program pro monitorování sítě tcpdump. Pomocí tcpdumpu je po dobu 3 sekund sledovány odchozí packety typu icmp request na mobilním rozhraní. Po příchodu logu z tcpdumpu je kontrolována velikost odesílaných packetů. Jestliže velikost packetů je rovna maximální velikosti packetů je test úkončen s nulovým návratovým kódem, tedy byl ukončen úspěšně.

\section{Funkce mobile edge}
Funkcionalita mobile edge popisuje možnost připojení testovaného zařízení do mobilní sítě skrz technologie GPRS a EDGE. Tyto technologie nepodporují všechny zařízení, která mají vlastnost mobilního připojení, z toho důvodu byla pro tuto vlastnost vytvořena samostatná funkcionalita. Testované zařízení se k technologii EDGE  připojují, jestliže v místě použití není dostupná lepší technologie, či zařízení lepší technologii nepodporuje nebo je možné správným parametrem vynutit připojení routeru do mobilní sítě skrze tuto technologii.

\subsection{Procedura type edge}
Procedura type EDGE popisuje možnost připojení zařízení do mobilní sítě skrz technologii EDGE. Možnost připojení technologií EDGE je testována vynucením technologie EDGE a čekáním na navázání spojení pomocí teto technologie. Test testující tuto vlastnost probíhá následovně. V prvním kroku je zálohován původní typ sítě pro pozdější obnovení a nastavíme nový typ sítě na typ GPRS/EDGE. Z důvodu projevení nastavených změn je restartováno mobilní spojení a dále je čekáno na nové sestavení spojení. Po úspěšném sestavení spojení je pomocí programu status zjištěna technologie, pomocí které je testované zařízení připojeno do mobilní sítě. Test je ukončen úspěšně, pokud zjištěný typ sítě odpovídá nastavené technologii EDGE. Na závěr testu se pouze nastaví zpět původní typ technologie.

\section{Funkce mobile umts}
Funkcionalita mobile UMTS popisuje vlastnost připojení zařízení do mobilní sítě pomocí technologie UMTS a HSPA+. Tyto technologie nepodporují všechny zařízení umožňující mobilní spojení. Například CDMA routery nepodporují GPRS přenosy, EDGE routery podporují maximálně technologie typu EDGE. Naopak LTE routery podporují i nižší technologie UMTS a EDGE. Zařízení komunikuje technologií UMTS jestliže nepodporuje nebo v místě použití není k dispozici lepší technologie nebo jestliže je správným parametrem vynucena technologie UMTS.

\subsection{Procedura type umts}
Procedura type umts popisuje možnost připojení zařízení do mobilní sítě skrz technologii UMTS. Testování technologie UMTS je prováděna totožným způsobem jako testování předešlé technologie EDGE. Jediným rozdílem v samotném testu je že místo technologie EDGE se nastavuje technologie UMTS a zjištěná technologie je porovnávána s technologií UMTS.

\section{Funkce mobile lte}
Funkcionalita mobile LTE popisuje vlastnost připojení zařízení do mobilní sítě pomocí technologie LTE. Technologie LTE je v nynější době nejrychlejší a nejvyspělejší bezdrátovou technologií podporovanou zařízeními společnosti Conel. Možnost komunikovat pomocí technologie LTE mají pouze LTE routery. Naopak tyto routery mají možnost komunikovat mimo LTE technologie i pomocí EDGE a UMTS technologií.

\subsection{Procedura type lte}
Procedura typu lte popisuje možnost připojení zařízení do mobilní sítě skrz technologii LTE. Testování technologie LTE je prováděno totožným způsobem jakou u předešlých technologií EDGE a UMTS. Jediným rozdílem v testovací proceduře je nastavování technologie LTE v konfiguraci a porovnávání vyčtené technologie s technologií LTE.

\section{Funkce mobile ppp}
Funkcionalita mobile ppp popisuje připojení zařízení do mobilního spojení pomocí protokolu ppp. Protokol ppp neboli point to point protokol je standardní protokol linkové vrstvy používaná v telekomunikaci. Chování testovaných zařízeních komunikujících tímto protokolem můžeme změnit například změnou autentizace, či vytáčeného čísla. Protokol ppp používají vesměs zařízení se staršími modely bezdrátových modulů, jelikož se jedná o velmi starý protokol, který je v dnešní době nahrazován novějšími a rychlejšími protokoly.

\subsection{Procedura chap}
Procedura chap popisuje vlastnost připojení protokolem ppp pomocí autentizace CHAP. Ve výchozím stavu router vybírá jednu z autentizací PAP či CHAP a pomocí té se přihlásí do mobilní sítě. Výchozí chování lze ovlivni změnou parametru autentizace na autentizaci CHAP, poté se bude router přihlašovat do sítě jedině autentizací CHAP. Testování zvolení autentizace CHAP probíhá následujícím způsobem. Nejdříve je zálohován původní typ autentizace a autentizace je nastavena na CHAP. Pro projevení změny typu autentizace je potřeba restart PPP spojení. Dále je čekáno na nové sestavení spojení se zvolenou autentizací. Po sestavení spojení je v logu hledána hláška od deamona pppd hlásící úspěšné přihlášení do sítě pomocí autentizace CHAP. Test končí úspěšně, jestliže je hláška "CHAP authentication succeeded" nalezena, v opačném případě skript končí s chybovým návratovým kódem.

\subsection{Procedura pap}
Procedura PAP popisuje vlastnost připojení routeru do mobilní sítě protokolem PPP pomocí autentizace PAP. Chování a nastavování autentizace již bylo popsáno v proceduře věnující se autentizaci CHAP. Samotné testování této autentizace je také shodné s testováním autentizace CHAP, až na dvě drobné změny. Při nastavování autentizace je nastavena autentizace PAP a hledaná hláška logu je změněna na "PAP authentication succeeded".

\subsection{Procedura number}
Procedura number popisuje vlastnost PPP spojení určující vytáčené číslo tímto spojením. Defaultně je vytáčené číslo zajišťující správné spojení, avšak v odůvodněných případech můžeme toto číslo pomocí parametru number změnit. Změna čísla se projeví změnou čísla v AT komandu ATD. Test vlastnosti probíhá následovně. Nejdříve je zálohováno původní telefonní číslo a nastaveno jakékoliv jiné číslo. Z důvodu projevení změny vytáčeného čísla je restartováno mobilní spojení. Po restartu mobilního spojení je po dobu 30 sekund sledován systémový log testovaného zařízení a je vyhledáván AT komand ATD s parametrem zadaného čísla v konfiguraci. Test je prohlášen za úspěšný, jestliže je daný komand v logu nalezen. Nakonec je navráceno původní telefonní číslo a mobilní spojení je restartováno.

\endinput
